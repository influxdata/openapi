post:
  operationId: PostQueryAst
  tags:
    - Query
  summary: Generate an Abstract Syntax Tree (AST) from a query
  description: |
    Analyzes a Flux query and generates a complete package source AST from the 
    query. 

    Use this endpoint for deeper query analysis. 

    #### Required permissions
    
    #### Limitations 
    
    #### Rate limits (with InfluxDB Cloud)
    `query` rate limits apply. For more information, see limits and adjustable 
    quotas.
  parameters:
    - $ref: "../parameters/TraceSpan.yml"
    - in: header
      name: Content-Type
      schema:
        type: string
        enum:
          - application/json
  requestBody:
    description: Analyzed Flux query to generate an AST.
    content:
      application/json:
        schema:
          $ref: "../schemas/LanguageRequest.yml"
  x-codeSamples:
    - lang: Shell
      label: cURL
      source: |
        curl --request POST 'INFLUX_URL/api/v2/query/ast' \
        --header 'Content-Type: application/json' \
        --header 'Accept: application/json \
        --header 'Authorization: Token INFLUX_TOKEN' \
        --data 'from(bucket: "example-bucket")
                  |> range(start: -5m)
                  |> filter(fn: (r) => r._measurement == "example-measurement")'
  responses:
    "200":
      description: AST of the Flux query.
      content:
        application/json:
          schema:
            $ref: "../schemas/ASTResponse.yml"
    default:
      description: Any response other than 200 is an internal server error.
      content:
        application/json:
          schema:
            $ref: "../schemas/Error.yml"
