summary: Bucket Schema
get:
  summary: Retrieve a measurement schema
  description: |
    Retrieves a measurement [schemas]({{% INFLUXDB_DOCS_URL %}}/reference/glossary/#schema).
  operationId: getMeasurementSchema
  parameters:
    - in: query
      name: org
      description: |
        Organization name.
        Only returns schemas owned by this organization.
      schema:
        type: string
    - in: query
      name: orgID
      description: |
        Organization ID.
        Only returns schemas owned by this organization.
      schema:
        type: string
    - in: path
      name: bucketID
      description: |
        The ID of the bucket to retrieve schemas from.
      schema:
        type: string
      required: true
    - in: path
      name: measurementID
      description: |
        The ID of the measurement schema to retrieve.
      schema:
        type: string
      required: true
  tags:
    - Bucket Schemas
  responses:
    '200':
      description: Schema definition for a single measurement
      headers:
        ETag:
          description: The current version of the measurement schema
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: "../schemas/MeasurementSchema.yml"
    "401":
      $ref: "../../common/responses/AuthorizationError.yml"
    '404':
      $ref: "../../common/responses/ResourceNotFoundError.yml"
    "500":
      $ref: "../../common/responses/InternalServerError.yml"
patch:
  summary: Update a measurement schema
  description: |
    Updates a measurement [schema]({{% INFLUXDB_DOCS_URL %}}/reference/glossary/#schema).

    Use this endpoint to update the columns of a measurement schema. The `name`,
    `type`, and `dataType` fields of the column can be updated.

    #### Limitations

    - The `name` of the measurement can't be updated.

    #### Related guides

    - [Manage bucket schemas]({{% INFLUXDB_DOCS_URL %}}/organizations/buckets/bucket-schema/).
    - [Using bucket schemas](https://www.influxdata.com/blog/new-bucket-schema-option-protect-from-unwanted-schema-changes/).
  operationId: updateMeasurementSchema
  parameters:
    - in: query
      name: org
      description: |
        Organization name.
        Only returns schemas owned by this organization.
      schema:
        type: string
    - in: query
      name: orgID
      description: |
        Organization ID.
        Only returns schemas owned by this organization.
      schema:
        type: string
    - in: path
      name: bucketID
      description: |
        The ID of the bucket to retrieve schemas from.
      schema:
        type: string
      required: true
    - in: path
      name: measurementID
      description: |
        The ID of the measurement schema to retrieve.
      schema:
        type: string
      required: true
  tags:
    - Bucket Schemas
  requestBody:
    content:
      application/json:
        schema:
          $ref: "../schemas/MeasurementSchemaUpdateRequest.yml"
  responses:
    '200':
      description: |
        Success.
        The response body contains the measurement schema.
      content:
        application/json:
          schema:
            $ref: "../schemas/MeasurementSchema.yml"
    '400':
      description: |
        Bad request.
      content:
        application/json:
          examples:
            missingColumnsExample:
              summary: Deleted columns
              description: >-
                The error returned when the request body does
                not contain all the columns from the source.
              value:
                code: invalid
                message: Unable to delete columns from schema
          schema:
            $ref: "../../common/schemas/Error.yml"
    "401":
      $ref: "../../common/responses/AuthorizationError.yml"
    '404':
      $ref: "../../common/responses/ResourceNotFoundError.yml"
    "500":
      $ref: "../../common/responses/InternalServerError.yml"
  x-codeSamples:
    - lang: Shell
      label: cURL
      source: |
        curl --request PATCH "https://cloud2.influxdata.com/api/v2/buckets/BUCKET_ID/schema/measurements \
          --header "Authorization: Token INFLUX_API_TOKEN" \
          --header "Accept: application/json" \
          --header "Content-Type: application/json" \
          --data '{
              "column": [
                {
                  "type": "tag",
                  "name": "location"
                },
                {
                  "type": "field",
                  "name": "value",
                  "dataType": "float"
                },
                {
                  "type": "timestamp",
                  "name": "time"
                }
              ]
            }'
